// The basics for my web projects. https://github.com/svexican/web-extras 

//
//
window.location.getQueryParam=function(e){var a,n,r;return a=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+a+"=([^&#]*)"),r=n.exec(location.search),null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},window.location.updateQueryParam=function(e,a){var n,r,c;return c=location.search,n=new RegExp("([?&])"+e+"=.*?(&|$)","i"),r=-1!==c.indexOf("?")?"&":"?",c.match(n)?null===a?c.replace(n,""):c.replace(n,"$1"+e+"="+a+"$2"):""+c+r+e+"="+a};

//
//
null==window.location.getQueryParam&&(console.log("getQueryParams has not been loaded! Redefining..."),window.location.getQueryParam=function(e){var r,o,a;return r=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),o=new RegExp("[\\?&]"+r+"=([^&#]*)"),a=o.exec(location.search),null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}),window.dictionary={},window.translator=function(e){var r,o,a,n;o=location.getQueryParam("lang")||localStorage.lang||"en",localStorage.lang=o,a=[];for(r in e)n=e[r],a.push(window.dictionary[r]=n[o]);return a},window.base_dictionary={cancel:{es:"Cancelar",en:"Cancel"},alert:{es:"Alerta",en:"Alert"},OK:{es:"OK",en:"OK"},error:{es:"Error",en:"Error"},weekdays:{es:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],en:["January","February","Mach","April","May","June","July","August","September","October","November","December"]},working:{es:"Trabajando...",en:"Working..."},file:{es:"Archivo",en:"File"},line:{es:"Línea",en:"Line"},js_error:{es:"Error de JS",en:"JS error"},js_error_message:{es:"Hubo un error en el navegador, por favor reporta los siguientes datos a un administrador.",en:"This is probably a bug on the browser, report the following details to an administrator."},almost:{es:"Casi",en:"Almost"},done:{es:"¡Listo!",en:"¡Done!"},clear:{es:"Limpiar",en:"Clear"},filetype_error_title:{es:"Tipo de archivo",en:"File type error"},filetype_error_message:{es:"Sólo se pueden subis los siguientes tipos de archivos:",en:"File is not in the accepted file types:"},filesize_error_title:{es:"Tamaño de archivo",en:"File size error"},filesize_error_message:{es:"¡El archivo es demasiado grande! El límite es: ",en:"File is too large! The limit is: "},and:{es:"y",en:"and"}},translator(window.base_dictionary);

//
//
$.fn.subs_matcher=function(n){var t,e,r,o,i,u;return t=this,o=function(t){return n.match_callback?utils.fnRun(n.match_callback,t):t.matches=!0},u=function(t){return n.unmatch_callback?utils.fnRun(n.unmatch_callback,t):t.matches=!1},r=function(t,e){return e.every(function(e){var r;return r=new RegExp(e.regExpEscape(),"i"),n.attributes.some(function(n){return t[n].split(" ").some(function(n){return r.test(n)})})})},e=function(n,t){var r;return n.removeClass("active"),r="up"===t?n.prev():n.next(),0===r.length?!1:r.is(":visible")?r.addClass("active"):e(r,t)},i=function(){return $(n.dropdown+" li").removeClass("active"),$(n.dropdown+" li:visible").first().addClass("active"),$(n.dropdown+" #too-many").hide(),$(n.dropdown+" #no-results").hide()},n.dropdown&&(t.blur(function(){return setTimeout(function(){return $(n.dropdown).hide()},500)}),t.focus(function(){return t.trigger("input")}),t.keydown(function(t){var r,o;switch(o=$(n.dropdown+" li.active"),r=o.first(),t.keyCode){case 13:return t.preventDefault(),r.find("a").click();case 38:return t.preventDefault(),0===o.length?$(n.dropdown+" li:visible").last().addClass("active"):e(r,"up");case 40:return t.preventDefault(),0===o.length?$(n.dropdown+" li:visible").first().addClass("active"):e(r,"down")}})),t.keydown(function(n){return 27===n.keycode?($(n.target).val(null),$(n.target).trigger("input")):void 0}),t.bind("input",function(){var e,a,c;if(a=t.val(),a.length>=(+n.min_char||0)&&(c=a.split(" "),e=0,n.collection.forEach(function(n){return r(n,c)?(o(n),e+=1):utils.fnRun(u(n))}),n.dropdown))switch(i(),!1){case!!e:return $(n.dropdown+" #no-results").show();case!(e>n.dropdown_size):return $(n.dropdown+" .too-many").show();default:return $(n.dropdown+" .too-many").hide()}})};

//
//
$.each(["put","del"],function(e,t){return $[t]=function(e,n,u,a){return"del"===t&&(t="delete"),$.isFunction(n)&&(a=a||u,u=n,n=void 0),$.ajax({url:e,type:t,dataType:a,data:n,success:u})}});

//
//
var HTMLCalendar;HTMLCalendar=function(t,a,e,n){var r,s,d,i,l,o,h,y,c,u,g,f,m,D,b,p,v,w,k,M,H;for(null==n&&(n=[]),M=dictionary.weekdays,b=dictionary.months,k=new Date,this.month=null==a?k.getMonth():a-1,this.year=null==e?k.getFullYear():e,p=new Date(this.year,this.month,1).getDay(),D=new Date(this.year,this.month+1,0).getDate(),H="",y=g=0;6>=g;y=++g)H+="<th> "+M[y]+" </th>";for(l=1,w="",y=f=0;5>=f;y=++f){for(d="",u=m=0;6>=m;u=++m)i=new Date(this.year,this.month,l).standardDate(),D>=l&&(y>0||u>=p)?(o="<span class='day_tag'>"+l+"</span>",h="",c="",s="",n.length>0&&n.forEach(function(t){return t.starts<=i&&t.ends>=i?(o="<strong class='day_tag'> "+l+" </strong>",h="has-events",s+="<div class='marker' style='background-color: "+t.color+"' bind='tooltip' title='"+t.name+"'> <span class='marker-id' id='"+t.id+"' style='display: none;'>"+t.id+"</span> </div>"):void 0}),i===(new Date).standardDate()&&(c="is-today"),r="<td class='day "+c+" "+h+"'> "+o+" "+s+" </td>",l+=1):r="<td></td>",d+=r;if(w+="<tr> "+d+" </tr>",l>D)break}return v="<table class='table'> <thead> <tr><th colspan='7' style='text-align: center;'> "+b[this.month]+" "+this.year+" </th></tr> <tr> "+H+" </tr> <thead> <tbody> "+w+" </tbody> </table>",document.getElementById(t).innerHTML=v},"undefined"!=typeof jQuery&&null!==jQuery&&($.fn.calendar=function(t,a,e){return HTMLCalendar(this[0].id,t,a,e)});

//
//
window.dnd=function(e){var n,t,a,r,s,o,d;return window.jQuery?"css"===e?(console.log("This is a sample CSS for this to look nicely \n .right-pane {\n display: inline-block;\n \n position: absolute;\n top: 0;\n \n width: 60%;\n padding: 0 10px;\n }\n \n .left-pane {\n display: inline-block;\n width: 40%;\n }\n \n .left-pane .form-group {\n margin: 0 10px 10px 10px;\n max-width: 20em;\n }\n \n .over-accept {\n transition: all .2s ease-in-out;\n transform: scale(1.1);\n -webkit-transform: scale(1.1);\n }\n \n .over-deny {\n background-color: white;\n opacity: 0.5;\n \n transition: all .2s ease-in-out;\n transform: scale(0.9);\n -webkit-transform: scale(0.9);\n }\n"),void 0):(s=null,o=function(n){return s=n.target,utils.fnRun(e.dragStart,n),n.dataTransfer.effectAllowed="copy",n.dataTransfer.setData("text",this.id)},t=function(n){var t,a,r;return n.stopPropagation(),utils.fnRun(e.dragEnter,n),t=$(n.target).closest(e.droppables),a=$(s).attr("is"),"none"===t.attr("accepts")||t.hasClass("over-deny")||!a?(n.dataTransfer.dropEffect="none",!1):"all"!==(r=t.attr("accepts"))&&r!==a?t.addClass("over-deny"):t.hasClass("over-accept")?void 0:(t.addClass("over-accept"),n.dataTransfer.dropEffect="copy")},r=function(n){var t;return n.preventDefault(),n.stopPropagation(),t=$(n.target).closest(e.droppables),"none"===t.attr("accepts")||t.hasClass("over-deny")||!$(s).attr("is")?(n.dataTransfer.dropEffect="none",!1):(t.hasClass("over-accept")||t.addClass("over-accept"),utils.fnRun(e.dragOver,n))},a=function(n){return n.preventDefault(),utils.fnRun(e.dragLeave,n),$(n.target).closest(e.droppables).removeClass("over-accept")},n=function(n){return utils.fnRun(e.dragEnd,n),$(e.droppables).removeClass("over-accept"),$(e.droppables).removeClass("over-deny"),s=null},d=function(t){var a,r,o;return t.preventDefault(),t.stopPropagation(),a=$(t.target).closest(e.droppables),r=$(s).attr("is"),("all"===(o=a.attr("accepts"))||o===r)&&utils.fnRun(e.drop,t),n(),!1},$(e.draggables).each(function(e,t){return t.addEventListener("dragstart",o,!1),t.addEventListener("dragend",n,!1)}),$(e.droppables).each(function(e,n){return n.addEventListener("dragover",r,!1),n.addEventListener("dragenter",t,!1),n.addEventListener("dragleave",a,!1),n.addEventListener("drop",d,!1)})):(alert("dnd requires jQuery (for now)"),!1)};

//
//
$.fn.toObject=function(t){var n;return null==t&&(t="name"),n=new Object,this.find("["+t+"]").each(function(e,r){var a,u;return a=$(r),u=a.attr(t),n[u]=function(){switch(a.attr("type")){case"password":return $.md5(a.val());case"checkbox":return a.is(":checked");case"number":return+a.val();default:return a.val()}}(),!0}),n},$.fn.fillIn=function(t,n){return null==n&&(n="name"),this.find("input, textarea").each(function(e,r){var a;return a=$(r).attr(n),a&&t[a]?$(r).val(t[a]):void 0}),this};

//
//
var indexOf=[].indexOf||function(e){for(var r=0,t=this.length;t>r;r++)if(r in this&&this[r]===e)return r;return-1};$.fn.uploadFile=function(e){var r,t,n,o,i,a,s,u,l,d,f,p,c,m,x,y,g,h;if(r=this,f=e.url,d=e.type||"POST",g=e.payload||{},l=e.max_size||4e6,m=e.extensions||[],p=e.extension_error||function(e,r){return bs.alert({title:dictionary.filetype_error_title,text:dictionary.filetype_error_message+" "+r.humanPrint(", ",dictionary.and)})},s=function(r){return null!=e.before&&e.before(r),$("#upload-progress").text("0%"),$("#upload-progress-modal").modal("show")},x=e.progress||function(e){return $("#upload-progress").text(function(){return"100%"===e?dictionary.almost+"...":e})},n=function(r){return null!=e.success&&e.success(r),$("#upload-progress").text(dictionary.done),$("#upload-progress-modal").modal("hide")},t=function(r,t,n){return 413===r.status&&$("#upload-progress").text(dictionary.file_too_large),e.error(r,t,n)},h=e.filesize_error||function(){return bs.alert({title:dictionary.filesize_error_title,text:dictionary.filesize_error_message+" "+l})},a=new FormData,i=this[0].files[0],o=(i.name||i.fileName).split(".").pop().toLowerCase(),m.length&&indexOf.call(m,o)<0)return p(o,m),!1;if(!i)return!1;c={error:$.noop,success:$.noop,start:$.noop,complete:$.noop},a.append(this.attr("name"),i);for(u in g)y=g[u],a.append(u,y);return $.ajax({type:d,url:f,data:a,cache:!1,contentType:!1,processData:!1,xhr:function(){var e;return e=$.ajaxSettings.xhr(),e.upload.onprogress=function(e){return x((e.loaded/e.total*100>>0)+"%")},e.onloadstart=function(){return c.start.apply(self)},e},beforeSend:function(e){return i.size>l?(e.abort(),h(i.size),!1):(e.setRequestHeader("X-XHR-Upload","1"),e.setRequestHeader("X-File-Name",i.name||i.fileName),e.setRequestHeader("X-File-Size",i.fileSize||i.size),s(e))},error:function(e,r,n){return t(e,r,n)},success:function(e){return n(e)}})};

//
//
var noKeyFormat,prettyFormat,hasProp={}.hasOwnProperty;prettyFormat=function(n){var r,e,a,t;try{t=new String,a=JSON.parse(n);for(e in a)t+=e+": "+a[e]+" <br />";return t}catch(o){return r=o,n}},noKeyFormat=function(n){var r,e;try{return function(){var a,t;a=JSON.parse(n),t=[];for(r in a)hasProp.call(a,r)&&(e=a[r],t.push(e+"<br />"));return t}().join("")}catch(a){return n}},window.flash={css:function(){return console.log("This is a sample CSS for this to look nicely: \n \n [bind='flash'] {\n opacity: 0.9;\n border-radius: 0 !important;\n }\n \n #js-error { margin: 100px !important; }\n \n #api-message-container {\n position: fixed;\n width: 100%;\n margin: auto;\n top: 15px;\n text-align: center;\n z-index: 9999;\n }\n \n #api-message-container > span.alert { padding: 16px; }\n #api-message-container > div.error { margin-top: -16px; }\n")},error:function(n){return $("#api-message-container").append("<div class='error alert alert-danger' bind='flash'><span bind='error-message'>"+n+"</span></div>")},success:function(n){return $('[bind="flash"]').remove(),$("#api-message-container").append("<span class='success alert alert-success' bind='flash'><span bind='message'>"+n+"</span></span>"),$('[bind="flash"]').delay(5e3).fadeOut("fast")},info:function(n){return $("#api-message-container").append("<span class='info alert alert-info' bind='flash'>"+n+"</span>")}},$(document).ajaxStart(function(){return $('[bind="flash"]').remove()}),$(document).ajaxSend(function(){return flash.info(dictionary.working)}),$(document).ajaxSuccess(function(n,r){var e;return e=r.getResponseHeader("API-Message"),null!==e&&void 0!==e?flash.success(decodeURIComponent(escape(e))):void 0}),$(document).ajaxError(function(n,r){return 422===r.status?flash.error(prettyFormat(r.responseText)):flash.error(prettyFormat(r.status+": "+prettyFormat(r.responseText)))}),$(document).ajaxComplete(function(){return $('[bind="flash"].info').remove()}),$(document).on("click","#api-message-container",function(){return $('[bind="flash"]').remove()}),window.onerror=function(n,r,e){return $('[bind="flash"].info').remove(),$("body").prepend("<div id='js-error' class='error alert alert-danger'> <p> <b>"+dictionary.js_error+"</b> "+dictionary.js_error_message+" </p> <p> "+dictionary.error+": "+n+"<br /> "+dictionary.file+":  "+r+"<br /> "+dictionary.line+":  "+e+" </p> </div>"),!1};

//
//
$.fn.sortableTable=function(n){var e;return e=this.find("th"),e.each(function(r,o){var a,s;return a=$(o),s=a.attr("sort-field"),null!=s?(a.attr("reverse","nil").addClass("pointer").append('<span class="glyphicon glyphicon-none float-right"></span>'),a.on("click",function(){var r,o,l;switch(l=a.attr("reverse"),$("[reverse]").attr("reverse","nil"),r=a.find("span.glyphicon"),e.find("span.glyphicon").removeClass("glyphicon-chevron-up glyphicon-chevron-down"),e.find("span.glyphicon").addClass("glyphicon-none"),l){case"false":o=!1,a.attr("reverse",!0),r.removeClass("glyphicon-none"),r.addClass("glyphicon-chevron-up");break;case"true":case"nil":o=!0,a.attr("reverse",!1),r.removeClass("glyphicon-none"),r.addClass("glyphicon-chevron-down")}return n.collection.sort_p(s,o,function(n){return null==n?!1:n.toString().toLowerCase()})})):void 0})};

//
//
$.fn.datasheet=function(t,a){var e,s,r,n,i;switch(t){case"show":r=[];for(e in a)i=a[e],i.match(/http/)?this.append("<strong>"+e+"</strong>: <a href='"+i+"'>"+i+"</a>"):this.append("<strong>"+e+"</strong>: "+i),r.push(this.append("<br />"));return r;case"get":return s={},this.find('[datasheet="row"]').each(function(t,a){var r,n;return n=$(a),r=n.find('[datasheet="key"]'),e=r.val()||r.text(),""!==e.trim()?(i=n.find('[datasheet="value"]').val(),s[e]=i):void 0}),s;case"form":n=[];for(e in a)i=a[e],n.push(this.append("<li class='row' datasheet='row'> <div class='col-md-2 right'> <strong><span datasheet='key'>"+e+"</span>:</strong> </div> <div class='col-md-10'> <textarea class='form-control' datasheet='value'>"+i+"</textarea> </div> </li></br>"));return n}};